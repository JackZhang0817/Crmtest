<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<meta charset="utf-8"/>
<title>我的客户 | CRM客户管理系统</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="description"/>
<meta content="gaorenhua" name="author"/>
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<link href="__PUBLIC__/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="__PUBLIC__/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="__PUBLIC__/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="__PUBLIC__/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="__PUBLIC__/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<link href="__PUBLIC__/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/jquery-tags-input/jquery.tagsinput.css">
<!-- END GLOBAL MANDATORY STYLES -->
<!-- BEGIN PAGE LEVEL STYLES -->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/bootstrap-datepicker/css/datepicker.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/bootstrap-toastr/toastr.min.css">

<!-- END PAGE LEVEL STYLES -->
<!-- BEGIN THEME STYLES -->
<include file="Common:css" />
<!-- END THEME STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed page-quick-sidebar-over-content ">
<!-- 包含公共头部和公共侧边栏 -->
<include file="Common:header" />
	<!-- BEGIN CONTENT -->
	<div class="page-content-wrapper">
		<div class="page-content">
			<!-- BEGIN PAGE CONTENT-->
			<div class="row">
				<div class="col-md-12">
				<!-- BEGIN EXAMPLE TABLE PORTLET-->
                    <div class="portlet box purple">
                        <div class="portlet-title">
                            <div class="caption">
                                <i class="fa fa-gift"></i>字段管理
                            </div>
                            <div class="tools">
                                <a href="javascript:;" class="collapse" data-original-title="" title="">
                                </a>
                                <a href="#portlet-config" data-toggle="modal" class="addNewClass" data-original-title="" title="">111
                                </a>
                                <a href="javascript:;" class="reload" data-original-title="" title="">
                                </a>
                                <a href="javascript:;" class="remove" data-original-title="" title="">
                                </a>
                            </div>
                        </div>
                        <div class="portlet-body ">
                            <!-- BEGIN FORM-->
                            <form action="#" class="form-horizontal">
                                <volist name="list" id="vo">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">{$vo.class_name}</label>
                                        <div class="col-md-6">
                                            <input type="text" class="form-control tags medium tags-change" data-val="{$vo.class_id}" value="{$vo.child}" style="display: none;">
                                        </div>
                                    </div>
                                </volist>
                            </form>
                            <!-- END FORM-->
                        </div>
                    </div>
				<!--END EXAMPLE TABLE PORTLET-->
				</div>
			</div>
			<!-- END PAGE CONTENT-->
		</div>
	</div>
	<!-- END CONTENT -->
</div>
<!-- END CONTAINER -->
<include file="Common:footer" />
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]-->
<script src="__PUBLIC__/global/plugins/respond.min.js"></script>
<script src="__PUBLIC__/global/plugins/excanvas.min.js"></script>
<![endif]-->
<script src="__PUBLIC__/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.3.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="__PUBLIC__/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="__PUBLIC__/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/select2/select2.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-tags-input/jquery.tagsinput.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-toastr/toastr.min.js"></script>
<script src="__PUBLIC__/global/plugins/bootbox/bootbox.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<script type="text/javascript">
	var displayFields_url = "{:U('Customer/displayFields')}";
</script>
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="__PUBLIC__/admin/pages/scripts/ui-toastr.js"></script>
<script src="__PUBLIC__/global/scripts/metronic.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="__PUBLIC__/javascript/table-defined.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/pages/scripts/form-validation.js"></script>
<script src="__PUBLIC__/layer/layer.min.js"></script>
<script>
jQuery(document).ready(function() {
	Metronic.init(); // init metronic core components
	Layout.init(); // init current layout
	QuickSidebar.init(); // init quick sidebar
	Demo.init(); // init demo features
	FormValidation.init();
    UIToastr.init();
	toastr.options = {
			"closeButton": true,
			"debug": false,
            "positionClass": "toast-top-center",
            "onclick": null,
            "showDuration": "1000",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }
	$('body').delegate('.addNewClass', "click", function () {
                var alertMaUrl = "{:U('Customer/addNewClass')}"
                bootbox.prompt({
                    title: "添加类型",
                    size: 'small',
                    inputType: 'text',
                    callback: function (result) {
                        if (result != null) {
                            $.post(alertMaUrl, {class_name: result, pid: 0}, function (res) {
                                if (res.code == 1) {
                                    toastr.success(res.msg, '添加成功');
                                }else{
                                    toastr.error(res.msg, '修改失败');
								}
                            })
                        }
                    }
                })
            })

    var handleTagsInput = function () {
        if (!jQuery().tagsInput) {
            return;
        }
        $('.tags-change').tagsInput({
            width: 300,
            'onAddTag': function (result) {
                var alertMaUrl = "{:U('Customer/addNewClass')}"
                var pid = $(this).attr('data-val')
                $.post(alertMaUrl, {class_name: result, pid: pid}, function (res) {
                    console.log(res)
                    if(res.code == 1) {
                        toastr.success(res.msg, '添加成功');
                    }else{
                        toastr.error(res.msg, '添加失败');
                    }
                })
            },
            'onRemoveTag': function (result) {
                var delUrl = "{:U('Customer/delNewClass')}"
                var pid = $(this).attr('data-val')
                $.post(delUrl, {class_name: result, pid: pid}, function (res) {
                    if(res.code == 1) {
                        toastr.success(res.msg, '删除成功');
                    }else{
                        toastr.error(res.msg, '删除失败');
                    }
                })
            },
            'removeWithBackspace' : false,
        })
        $('#tags_1').tagsInput({
            width: 'auto',
            'onAddTag': function (res) {
                console.log($(this).attr('data-val'))
                console.log(res)
                console.log(index)
            },
            'onRemoveTag': function (res) {
                console.log(res)
                $('#tags_1').addTag(res, 2)
            },
            'removeWithBackspace' : false,
        });
        $('#tags_2').tagsInput({
            width: 300
        });
    };
    handleTagsInput()
    // 点击排序
    $('th.cc').click(function(){
        var url = $(this).attr('data-src');
        window.location.href = url;
    });

    // 点击修改
    $(".cup").dblclick(function(){
        var text = $(this).text();
        var id = $(this).attr('data');
        var name = $(this).attr('data-name');
        if (text == '--') {
            var input = "<input type='text' name='"+ name +"' />";
        } else {
            var input = "<input type='text' name='"+ name +"' value='"+ text +"' />";
        }

        $(this).html(input);
        $(this).children().focus();
        $(this).children().blur(function(){
            var url = "{:U('Customer/fastUpdate')}"
            var val = $(this).val();
            if (val == '') {
                $(this).parent().html('--');
            } else {
                $(this).parent().html(val);
                $.post(url, {id:id,name:name,value:val},function(msg){
                    if (msg == 'false') {
                        alert('更新失败');
                    }
                });
            }
        });
    });

    // 点击修改
    $(".cup1").on('dblclick', function(){
        var text = $(this).text();
        var id = $(this).attr('data');
        var name = $(this).attr('data-name');
        if (text == '--') {
            var input = "<input type='text' class='date-picker' name='"+ name +"' />";
        } else {
            var input = "<input type='text' class='date-picker' name='"+ name +"' value='"+ text +"' />";
        }

        $(this).html(input);
        $(this).children().focus();
        $(this).children().blur(function(){
            var url = "{:U('Customer/fastUpdate')}"
            var val = $(this).val();
            if (val == '') {
                $(this).parent().html('--');
            } else {
                $(this).parent().html(val);
                $.post(url, {id:id,name:name,value:val},function(msg){
                    if (msg == 'false') {
                        alert('更新失败');
                    }
                });
            }
        });
    });

    // 是否删除提示
    $('.delcfm').click(function(){
        var url = $(this).attr('src');
        $.layer({
            shade: [0],
            area: ['auto','auto'],
            dialog: {
                msg: '您确定要删除本条信息吗? 删除后可在『回收站』恢复!',
                btns: 2,
                type: 4,
                btn: ['确定','取消'],
                yes: function(){
                    window.location = url;
                }, no: function(){
                    return false;
                }
            }
        });
    });

    //导入excel
    $('#importExcel').click(function(){
        var filename = $('#iefile').val();
        var mime = filename.toLowerCase().substr(filename.lastIndexOf("."));
        if(mime == ".xls" || mime == ".xlsx"){
//            $.ajaxFileUpload ({
//                url: "{:U('Customer/importExcel')}",
//                type: "POST",
//                secureuri: false,
//                dataType: 'json',
//                fileElementId :"iefile",
//                success : function (data, status, e){
//                    console.log(data);
//                },
//                error: function (data, status, e){
//                    alert(e);
//                }
//            })
            $('#importExcelForm').submit();
        } else
            alert('上传文件必须为excel格式');
    })

});

function selectFile(fnUpload) {

}
</script>
</body>
<!-- END BODY -->
</html>

<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title>施工客户管理 | CRM客户管理系统</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="gaorenhua" name="author"/>
    <!-- BEGIN GLOBAL MANDATORY STYLES -->

    <link href="__PUBLIC__/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="__PUBLIC__/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="__PUBLIC__/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="__PUBLIC__/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <link href="__PUBLIC__/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet"
          type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/select2/select2.css"/>
    <link rel="stylesheet" type="text/css"
          href="__PUBLIC__/global/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.css"/>
    <link rel="stylesheet" type="text/css"
          href="__PUBLIC__/global/plugins/bootstrap-markdown/css/bootstrap-markdown.min.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/bootstrap-datepicker/css/datepicker.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/bootstrap-toastr/toastr.min.css">
    <!-- END PAGE LEVEL SCRIPTS -->
    <!-- BEGIN THEME STYLES -->
    <include file="Common:css"/>
    <!-- END THEME STYLES -->
    <link rel="shortcut icon" href="favicon.ico"/>
</head>
<style>
    /*.portlet.box.blue {*/
    /*border: none;*/
    /*}*/

    /*.portlet.box.blue > .portlet-title {*/
    /*background-color: white;*/
    /*border-bottom: 1px solid #333;*/
    /*}*/

    /*.portlet.box.blue > .portlet-title > .caption {*/
    /*color: #333;*/
    /*}*/

    /*.portlet.box.blue > .portlet-title > .caption > i {*/
    /*color: #333*/
    /*}*/
    .portlet.box > .portlet-title > .caption {
        padding: 18px 0 9px 0;
    }
</style>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed page-quick-sidebar-over-content ">
<!-- 包含公共头部和公共侧边栏 -->
<include file="Common:header"/>
<!-- BEGIN CONTENT -->
<div class="page-content-wrapper">
    <div class="page-content">
        <!-- BEGIN PAGE CONTENT-->
        <div class="row">
            <div class="col-md-12">
                <!-- BEGIN VALIDATION STATES-->
                <div class="portlet box grey">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="fa fa-cogs"></i>施工客户列表
                            (超期数: {$promotion_info.chaoqi_num} 超期率：{$promotion_info.promotion})
                            (满意数: {$satisfied_info.satisfied_num} 满意率：{$satisfied_info.satisfied_pro})
                        </div>
                        <div class="tools">
                            <!--<select id="alert_type" class="form-control input-medium">-->
                                <!--<option value="0">全部</option>-->
                                <!--<volist name="type" id="vo">-->
                                    <!--<option value="{$vo.type_id}">{$vo.type_name}</option>-->
                                <!--</volist>-->
                            <!--</select>-->
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>
                                        序号
                                    </th>
                                    <th>
                                       客户姓名
                                    </th>
                                    <th>
                                        电话
                                    </th>
                                    <th>
                                        施工地址
                                    </th>
                                    <th>
                                        监理/工队长
                                    </th>
                                    <th>
                                        施工进度
                                    </th>
                                    <th>
                                        施工日期
                                    </th>
                                    <th>
                                        施工状态
                                    </th>
                                    <th>
                                        是否满意
                                    </th>
                                    <th>
                                        创建时间
                                    </th>
                                    <th>
                                        操作
                                    </th>
                                </tr>
                                </thead>
                                <tbody id="mlist-body">
                                    <include file="ajaxProject"/>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- end validation states-->
            </div>
        </div>
        <!-- end page content-->
    </div>
</div>
<!-- end content -->
</div>
<!-- end container -->
<include file="Common:footer"/>
<!-- begin javascripts(load javascripts at bottom, this will reduce page load time) -->
<!-- begin core plugins -->
<!--[if lt ie 9]>
<script src="__PUBLIC__/global/plugins/respond.min.js"></script>
<script src="__PUBLIC__/global/plugins/excanvas.min.js"></script>
<![endif]-->
<script src="__PUBLIC__/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<!-- important! load jquery-ui-1.10.3.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="__PUBLIC__/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js"
        type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- end core plugins -->
<!-- begin page level plugins -->
<script type="text/javascript" src="__PUBLIC__/global/plugins/jquery-validation/js/jquery.validate.min.js"></scrit>
    <script type="text/javascript"
            src="__PUBLIC__/global/plugins/jquery-validation/js/additional-methods.min.js"></script>
    <
    script
    type = "text/javascript"
    src = "__PUBLIC__/global/plugins/select2/select2.min.js" ></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/bootstrap-wysihtml5/wysihtml5-0.3.0.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/bootstrap-markdown/js/bootstrap-markdown.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/bootstrap-markdown/lib/markdown.js"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-toastr/toastr.min.js"></script>
<script src="__PUBLIC__/global/plugins/bootbox/bootbox.min.js" type="text/javascript"></script>
<!-- end page level plugins -->
<!-- begin page level styles -->
<script src="__PUBLIC__/admin/pages/scripts/ui-toastr.js"></script>
<script src="__PUBLIC__/global/scripts/metronic.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/pages/scripts/form-validation.js"></script>
<!-- end page level styles -->
<script>
    jQuery(document).ready(function () {
        // initiate layout and plugins
        Metronic.init(); // init metronic core components
        Layout.init(); // init current layout
        QuickSidebar.init(); // init quick sidebar
        Demo.init(); // init demo features
        UIToastr.init();
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "positionClass": "toast-top-center",
            "onclick": null,
            "showDuration": "1000",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }
        $('#alert_type').change(function () {
            var type_id = $(this).find("option:selected").val()
            var ajax_url = "{:U('Material/materialList')}"
            $.post(ajax_url, {type_id: type_id,}, function (res) {
                $('#mlist-body').empty()
                $('#mlist-body').html(res)
            })
        })

        function getAjaxList() {
            var ajax_url = "__SELF__"
            $.post(ajax_url, {action:'list'}, function (res) {
                $('#mlist-body').html(res)
            })
        }

        window.onload = function () {
            $('body').delegate('.alertMaType', "click", function () {
                var alertMaUrl = "{:U('Material/alertMaterial')}"
                var type_id = $(this).attr('data-val')
                var type_name = $(this).attr('data-item')
                bootbox.prompt({
                    title: "修改材料名称",
                    size: 'small',
                    inputType: 'text',
                    value: type_name,
                    callback: function (result) {
                        if (result != type_name && result != null) {
                            $.post(alertMaUrl, {marterial_id: type_id, marterial_name: result}, function (res) {
                                if (res.code == 1) {
                                    getAjaxList()
                                } else {
                                    toastr.error(res.msg, '修改失败');
                                }
                            })
                        }
                    }
                })
            })
            $('body').delegate('.delMaType', "click", function () {
                var delTypeUrl = "{:U('Material/delMaterial')}"
                var type_id = $(this).attr('data-val')
                bootbox.confirm({
                    title: "确定删除吗?",
                    message: '删除之后不可恢复,请谨慎操作',
                    size: "small",
                    callback: function (result) {
                        if (result === true) {
                            $.post(delTypeUrl, {marterial_id: type_id}, function (res) {
                                if (res.code == 1) {
                                    getAjaxList()
                                } else {
                                    toastr.error(res.msg, "删除失败")
                                }
                            })
                        }
                    }
                })
            })
            $('body').delegate('.alertState', "click", function () {
                var state = $(this).attr('data-state');
                var id = $(this).attr('data-id')
                bootbox.prompt({
                    title: '修改超期状态',
                    inputType: 'select',
                    size: 'small',
                    value: state,
                    buttons: {
                        confirm: {
                            label: '确定',
                            className: 'btn-success'
                        }
                    },
                    inputOptions: [
                        {
                            text: '未超期',
                            value: 0,
                        },
                        {
                            text: '已超期',
                            value: 1,
                        }
                    ],
                    callback: function (result) {
                        if(result == state || result == null){
                            toastr.error('没有作出修改', "修改失败")
                        }else{
                            ajax_url = "__SELF__"
                            $.post(ajax_url, {action: 'edit_state', id: id, state: result}, function (res) {
                                toastr.success('修改状态成功', "修改成功")
                                getAjaxList()
                            })
                        }
                    }
                })
            })
            $('body').delegate('.alertSatisfied', "click", function () {
                var state = $(this).attr('data-state');
                var id = $(this).attr('data-id')
                bootbox.prompt({
                    title: '修改是否满意',
                    inputType: 'select',
                    size: 'small',
                    value: state,
                    buttons: {
                        confirm: {
                            label: '确定',
                            className: 'btn-success'
                        }
                    },
                    inputOptions: [
                        {
                            text: '不满意',
                            value: 0,
                        },
                        {
                            text: '满意',
                            value: 1,
                        }
                    ],
                    callback: function (result) {
                        if(result == state || result == null){
                            toastr.error('没有作出修改', "修改失败")
                        }else{
                            ajax_url = "__SELF__"
                            $.post(ajax_url, {action: 'edit_satisfied', id: id, state: result}, function (res) {
                                toastr.success('修改满意度成功', "修改成功")
                                getAjaxList()
                            })
                        }
                    }
                })
            })
            $('body').delegate('.page_a', "click", function () {
                $(this).parent().attr('class', 'paginate_button page_li active')
                $(this).parent().siblings().attr('class', 'paginate_button page_li')
                var type_id = $('#alert_type').find("option:selected").val()
                var ajax_url = "{:U('Material/materialList')}"
                var page_num = $(this).text()
                $.post(ajax_url, {type_id: type_id, page_num: page_num}, function (res) {
                    $('#mlist-body').html(res)
                })
            })
        }
    });
</script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>
<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title>项目列表 | CRM客户管理系统</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="gaorenhua" name="author"/>
    <!-- BEGIN GLOBAL MANDATORY STYLES -->

    <link href="__PUBLIC__/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="__PUBLIC__/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="__PUBLIC__/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="__PUBLIC__/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <link href="__PUBLIC__/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet"
          type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/select2/select2.css"/>
    <link rel="stylesheet" type="text/css"
          href="__PUBLIC__/global/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.css"/>
    <link rel="stylesheet" type="text/css"
          href="__PUBLIC__/global/plugins/bootstrap-markdown/css/bootstrap-markdown.min.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/bootstrap-datepicker/css/datepicker.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/bootstrap-toastr/toastr.min.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/select2/select2.css"/>
    <!-- END PAGE LEVEL SCRIPTS -->
    <!-- BEGIN THEME STYLES -->
    <include file="Common:css"/>
    <!-- END THEME STYLES -->
    <link rel="shortcut icon" href="favicon.ico"/>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed page-quick-sidebar-over-content ">
<!-- 包含公共头部和公共侧边栏 -->
<include file="Common:header"/>
<!-- BEGIN CONTENT -->
<div class="page-content-wrapper">
    <div class="page-content">
        <!-- BEGIN PAGE CONTENT-->
        <div class="row">
            <div class="col-md-6">
                <!-- BEGIN SAMPLE TABLE PORTLET-->
                <div class="portlet box green">
                    <div class="portlet-title">
                        <div class="caption"><i class="fa fa-cogs"></i>项目列表</div>
                    </div>
                    <div class="portlet-body">
                        <div class="table-responsive">
                            <form>
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>项目名称</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody id="styleList">
                                    <include file="ajaxCustomerPro"/>
                                    </tbody>
                                </table>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- END SAMPLE TABLE PORTLET-->
            </div>
            <div class="col-md-6">
                <!-- BEGIN VALIDATION STATES-->
                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="fa fa-gift"></i>添加项目
                        </div>
                    </div>
                    <div class="portlet-body form">
                        <!-- BEGIN FORM-->
                        <form class="form-horizontal">
                            <div class="form-body">
                                <div class="form-group">
                                    <label class="control-label col-md-3"> 客户姓名</label>
                                    <div class="col-md-7">
                                        <select class="form-control select2_category select2-offscreen" tabindex="-1"
                                                title="" name="customer_id" id="customer_id">
                                            <option value="0">请选择</option>
                                            <volist name="c_list" id="vo">
                                                <option value="{$vo.id}">{$vo.CName} {$vo.Tel}</option>
                                            </volist>
                                        </select>
                                        <!--<input type="text" name="Address" class="form-control"  />-->
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3"><span class="red">*</span> 项目名称</label>
                                    <div class="col-md-7">
                                        <select name="pro_id" id="pro_id" class="form-control">
                                            <option value="0">请选择项目名称</option>
                                            <volist name="p_list" id="vo">
                                                <option value="{$vo.project_id}">{$vo.project_name}</option>
                                            </volist>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3">日期</label>
                                    <div class="col-md-4">
                                        <div class="input-group input-large date-picker input-daterange"
                                             data-date="10/11/2012" data-date-format="mm/dd/yyyy">
                                            <input type="text" class="form-control" name="from">
                                            <span class="input-group-addon"> to </span>
                                            <input type="text" class="form-control" name="to">
                                        </div>
                                        <!-- /input-group -->
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <div class="row">
                                    <div class="col-md-offset-2 col-md-10">
                                        <a id="addClassBt" class="btn green">　确认添加　</a>
                                        <button type="button" class="btn default">重新填写</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <!-- END FORM-->
                    </div>
                </div>
                <!-- END VALIDATION STATES-->
            </div>
        </div>
        <!-- END PAGE CONTENT-->
    </div>
</div>
<!-- END CONTENT -->
</div>
<!-- END CONTAINER -->
<include file="Common:footer"/>
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="__PUBLIC__/global/plugins/respond.min.js"></script>
<script src="__PUBLIC__/global/plugins/excanvas.min.js"></script>
<![endif]-->
<script src="__PUBLIC__/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.3.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="__PUBLIC__/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js"
        type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script type="text/javascript" src="__PUBLIC__/global/plugins/jquery-validation/js/jquery.validate.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/jquery-validation/js/additional-methods.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/select2/select2.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/bootstrap-wysihtml5/wysihtml5-0.3.0.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/bootstrap-markdown/js/bootstrap-markdown.js"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/bootstrap-markdown/lib/markdown.js"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-toastr/toastr.min.js"></script>
<script src="__PUBLIC__/global/plugins/bootbox/bootbox.min.js" type="text/javascript"></script>
<script type="text/javascript" src="__PUBLIC__/global/plugins/select2/select2.min.js"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL STYLES -->
<script src="__PUBLIC__/admin/pages/scripts/ui-toastr.js"></script>
<script src="__PUBLIC__/global/scripts/metronic.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/pages/scripts/form-validation.js"></script>
<script src="__PUBLIC__/layer/layer.min.js"></script>
<!-- END PAGE LEVEL STYLES -->
<script>
    jQuery(document).ready(function () {
        // initiate layout and plugins
        Metronic.init(); // init metronic core components
        Layout.init(); // init current layout
        QuickSidebar.init(); // init quick sidebar
        Demo.init(); // init demo features
        FormValidation.init();
        UIToastr.init();
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "positionClass": "toast-top-center",
            "onclick": null,
            "showDuration": "1000",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }

        $('.select2_category').select2({
            placeholder: "Select an option",
            allowClear: true
        });
        // 点击修改的时候
        $('.update').click(function () {
            $.get("{:U('updateWay')}", {id: $(this).attr('nums')}, function (msg) {
                $("#updaterecord").html(msg);
            });
        });

        // 是否删除提示
        $('.delcfm').click(function () {
            var url = $(this).attr('src');
            $.layer({
                shade: [0],
                area: ['auto', 'auto'],
                dialog: {
                    msg: '您确定要删除该信息吗？删除后无法恢复! ',
                    btns: 2,
                    type: 4,
                    btn: ['确定', '取消'],
                    yes: function () {
                        window.location = url;
                    }, no: function () {
                        return false;
                    }
                }
            });
        });
        $('#addClassBt').on('click', function () {
            var addUrl = "__SELF__";
            style_name = $('input[name="project_name"]').val()
            customer_id = $('#customer_id').find('option:selected').val()
            pro_id = $('#pro_id').find("option:selected").val()
            start_time = $('input[name="from"]').val()
            end_time = $('input[name="to"]').val()
            if(customer_id == 0){
                toastr.error('请选择客户','错误')
                return
            }
            if(pro_id == 0){
                toastr.error('请选择施工项目','错误')
                return
            }
            if(start_time == '' || end_time == ''){
                toastr.error('请选择开始或者结束时间','错误')
                return
            }
            data = {action: 'add', customer_id: customer_id, pro_id: pro_id, start_time: start_time, end_time: end_time}
            postFormMethod(addUrl, data)
        })

        $('body').delegate('.update', "click", function () {
            var alertMaUrl = "__SELF__"
            var id = $(this).attr('data-val')
            var style_name = $(this).attr('data-item')
            bootbox.prompt({
                title: "修改材料名称",
                size: 'small',
                inputType: 'text',
                value: style_name,
                callback: function (result) {
                callback: function (result) {
                    if (result != style_name && result != null) {
                        $.post(alertMaUrl, {action: 'update', id: id, project_name: result}, function (res) {
                            if (res.code == 1) {
                                getList()
                            } else {
                                toastr.error(res.msg, '修改失败');
                            }
                        })
                    }
                }
            })
        })
        $('body').delegate('.delcfm', "click", function () {
            var delTypeUrl = "__SELF__"
            var id = $(this).attr('data-val')
            bootbox.confirm({
                title: "确定删除吗?",
                message: '删除之后不可恢复,请谨慎操作',
                size: "small",
                callback: function (result) {
                    if (result === true) {
                        $.post(delTypeUrl, {action: 'delete', id: id}, function (res) {
                            if (res.code == 1) {
                                getList()
                                toastr.success(res.msg, "删除成功")
                            } else {
                                toastr.error(res.msg, "删除失败")
                            }
                        })
                    }
                }
            })
        })

        //post 公用方法
        function postFormMethod(url, info) {
            $.post(url, info, function (res) {
                console.log(res)
                if (res.code == 1) {
                    getList();
                    toastr.success(res.msg, '成功');
                } else {
                    toastr.error(res.msg, '失败');
                }
            })
        }

        //获取列表
        function getList() {
            var list_url = "__SELF__"
            $.post(list_url, {action: 'list'}, function (res) {
                if (res) {
                    $('#styleList').html(res)
                }
            })
        }
    });
</script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->



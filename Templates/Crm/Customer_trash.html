<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<meta charset="utf-8"/>
<title>我的客户 | CRM客户管理系统</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="description"/>
<meta content="gaorenhua" name="author"/>
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<link href="__PUBLIC__/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="__PUBLIC__/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="__PUBLIC__/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="__PUBLIC__/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="__PUBLIC__/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<!-- END GLOBAL MANDATORY STYLES -->
<!-- BEGIN PAGE LEVEL STYLES -->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/global/plugins/bootstrap-datepicker/css/datepicker.css"/>
<!-- END PAGE LEVEL STYLES -->
<!-- BEGIN THEME STYLES -->
<include file="Common:css" />
<!-- END THEME STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed page-quick-sidebar-over-content ">
<!-- 包含公共头部和公共侧边栏 -->
<include file="Common:header" />
	<!-- BEGIN CONTENT -->
	<div class="page-content-wrapper">
		<div class="page-content">
			<!-- BEGIN PAGE CONTENT-->
			<div class="row">
				<div class="col-md-12">
				<!-- BEGIN EXAMPLE TABLE PORTLET-->
                <div class="portlet box blue">
                <div class="portlet-title">
                    <div class="caption"><i class="fa fa-globe"></i>我的客户列表 -
                            <span style="font-size:14px;">&nbsp;共{$page}　
                                <neq name="sum" value=''>当前条件下的总金额 : ￥{$sum|number_format}</neq>
                            </span>
                    </div>
                    <div class="actions">
                        <div class="btn-group">
                            <a class="btn default" href="#" data-toggle="dropdown">选择列 <i class="fa fa-angle-down"></i></a>
                            <div id="sample_2_column_toggler" class="dropdown-menu hold-on-click dropdown-checkboxes pull-right">
                                <label><input id='c1' name="tijiao[]" type="checkbox" {:xianshi(1,display_field)} data-column="0" value="1">最新回访记录</label>
                                <label><input id='c2' name="tijiao[]" type="checkbox" {:xianshi(2,display_field)} data-column="1" value="2">状态</label>
                                <label><input id='c3' name="tijiao[]" type="checkbox" {:xianshi(3,display_field)} data-column="2" value="3">客户姓名</label>
                                <label><input id='c4' name="tijiao[]" type="checkbox" {:xianshi(4,display_field)} data-column="3" value="4">联系方式</label>
                                <label><input id='c5' name="tijiao[]" type="checkbox" {:xianshi(5,display_field)} data-column="4" value="5">所在小区</label>
                                <label><input id='c6' name="tijiao[]" type="checkbox" {:xianshi(6,display_field)} data-column="5" value="6">咨询时间</label>
                                <if condition="is_admin()">
                                    <label><input id='c7' name="tijiao[]" type="checkbox" {:xianshi(7,display_field)} data-column="6" value="7">业务员回访时间</label>
                                    <label><input id='c23' name="tijiao[]" type="checkbox" {:xianshi(23,display_field)} data-column="22" value="23">设计师回访时间</label>
                                    <label><input id='c24' name="tijiao[]" type="checkbox" {:xianshi(24,display_field)} data-column="23" value="24">工程监理回访时间</label>
                                    <else/>
                                    <label><input id='c7' name="tijiao[]" type="checkbox" {:xianshi(7,display_field)} data-column="6" value="7">回访时间</label>
                                </if>
                                <label><input id='c8' name="tijiao[]" type="checkbox" {:xianshi(8,display_field)} data-column="7" value="8">到店时间</label>
                                <label><input id='c9' name="tijiao[]" type="checkbox" {:xianshi(9,display_field)} data-column="8" value="9">定金时间</label>
                                <label><input id='c10' name="tijiao[]" type="checkbox" {:xianshi(10,display_field)} data-column="9" value="10">合同时间</label>
                                <label><input id='c11' name="tijiao[]" type="checkbox" {:xianshi(11,display_field)} data-column="10" value="11">合同编号</label>
                                <label><input id='c28' name="tijiao[]" type="checkbox" {:xianshi(28,display_field)} data-column="27" value="28">交房时间</label>
                                <label><input id='c29' name="tijiao[]" type="checkbox" {:xianshi(29,display_field)} data-column="28" value="29">量房时间</label>
                                <label><input id='c12' name="tijiao[]" type="checkbox" {:xianshi(12,display_field)} data-column="11" value="12">开工时间</label>
                                <label><input id='c13' name="tijiao[]" type="checkbox" {:xianshi(13,display_field)} data-column="12" value="13">竣工时间</label>
                                <label><input id='c14' name="tijiao[]" type="checkbox" {:xianshi(14,display_field)} data-column="13" value="14">定金金额</label>
                                <label><input id='c15' name="tijiao[]" type="checkbox" {:xianshi(15,display_field)} data-column="14" value="15">合同金额</label>
                                <label><input id='c16' name="tijiao[]" type="checkbox" {:xianshi(16,display_field)} data-column="15" value="16">面积</label>
                                <label><input id='c17' name="tijiao[]" type="checkbox" {:xianshi(17,display_field)} data-column="16" value="17">装修方式</label>
                                <label><input id='c18' name="tijiao[]" type="checkbox" {:xianshi(18,display_field)} data-column="17" value="18">设计师</label>
                                <label><input id='c19' name="tijiao[]" type="checkbox" {:xianshi(19,display_field)} data-column="18" value="19">业务员</label>
                                <label><input id='c20' name="tijiao[]" type="checkbox" {:xianshi(20,display_field)} data-column="19" value="20">工程监理</label>
                                <label><input id='c21' name="tijiao[]" type="checkbox" {:xianshi(21,display_field)} data-column="20" value="21">工长</label>
                                <label><input id='c22' name="tijiao[]" type="checkbox" {:xianshi(22,display_field)} data-column="21" value="22">渠道</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="portlet-body">
                    <!-- 搜索客户 -->
                    <form class="form-inline" method="get" action="{:U('Customer/t_search')}" >
                        <div class="col-md-11" style="padding:0px;">
                            <div class="control-group search" style="padding:0px;margin-bottom:5px;">
                                <input class="form-control input-sm" type="text" name="CName" placeholder="客户姓名" />
                                <input class="form-control input-sm" type="text" name="Tel" placeholder="联系方式" />
                                <input class="form-control input-sm" type="text" name="Address" placeholder="所在小区" />
                                <select name="Userid" class="form-control input-sm">
                                    <option value=''>业务员</option>
                                    <foreach name='users' item='u'>
                                        <neq name="u.id" value="0">
                                            <option value='{$u.id}'>{$u.realname}</option>
                                        </neq>
                                    </foreach>
                                </select>
                                <select name="Designer" class="form-control input-sm">
                                    <option value=''>设计师</option>
                                    <foreach name='designer' item='de'>
                                        <option value='{$de.id}'>{$de.realname}</option>
                                    </foreach>
                                </select>
                                <div class="btn-group">
                                    <a class="btn btn-sm" href="#" data-toggle="dropdown">
                                        客户状态
                                        <i class="fa fa-angle-down"></i>
                                    </a>
                                    <div id="sample_3_column_toggler" style="min-width:100px;" class="dropdown-menu hold-on-click dropdown-checkboxes pull-right">
                                        <foreach name='state' item='s'>
                                            <label><input type="checkbox" name="State[]" value="{$s.id}">{$s.state_id|stateName}</label>
                                        </foreach>
                                    </div>
                                </div>
                                <select name="Channel" class="form-control input-sm">
                                    <option value=''>渠道</option>
                                    <foreach name='channel' item='ch'>
                                        <option value='{$ch.id}'>{$ch.channelname}</option>
                                    </foreach>
                                </select>
                                <select name="Way" class="form-control input-sm">
                                    <option value=''>装修方式</option>
                                    <foreach name='way' item='w'>
                                        <option value='{$w.id}'>{$w.wayname}</option>
                                    </foreach>
                                </select>
                                <input class="form-control input-sm date-picker" type="text" placeholder="咨询时间-" name="ConsultDate" /><input class="form-control input-sm date-picker" type="text" placeholder="-咨询时间" name="ConsultDate1" />
                                <input class="form-control input-sm date-picker" type="text" placeholder="到店时间-" name="ComeTime" /><input class="form-control input-sm date-picker" type="text" placeholder="-到店时间" name="ComeTime1" />
                                <input class="form-control input-sm date-picker" type="text" placeholder="签单时间-" name="OrderTime" /><input class="form-control input-sm date-picker" type="text" placeholder="-签单时间" name="OrderTime1" />
                                <input class="form-control input-sm date-picker" type="text" placeholder="合同时间-" name="HetongTime" /><input class="form-control input-sm date-picker" type="text" placeholder="-合同时间" name="HetongTime1" />
                            </div>
                        </div>
                        <div class="col-md-1">
                            <button type="submit" class="btn btn-sm blue">搜索</button>
                        </div>
                    </form>
                    <!--客户记录列表开始---->
                    <table class="table table-bordered table-full-width table-striped">
                        <thead>
                        <tr>
                            <th class="c1">最新回访记录</th>
                            <th class="c2">状态</th>
                            <th class="c3">客户姓名</th>
                            <th class="c4">联系方式</th>
                            <th class="c5">所在小区</th>
                            <th class="c6">咨询时间</th>
                            <if condition="is_admin()">
                                <th class="c7" title="业务员下次回访客户的时间">业务回访</th>
                                <th class="c23" title="设计师下次回访客户的时间">设计回访</th>
                                <th class="c24" title="工程监理下次回访客户的时间">监理回访</th>
                                <elseif condition="is_salesman() || is_designer() || is_project() || is_manager()"/>
                                <th class="c7" title="下次回访客户的时间">回访时间</th>
                            </if>
                            <th class="c8">到店时间</th>
                            <th class="c9">定金时间</th>
                            <th class="c10">合同时间</th>
                            <th class="c11">合同编号</th>
                            <th class="c28">交房时间</th>
                            <th class="c29">量房时间</th>
                            <th class="c12">开工时间</th>
                            <th class="c13">竣工时间</th>
                            <th class="c14">定金金额</th>
                            <th class="c15">合同金额</th>
                            <th class="c16">面积</th>
                            <th class="c17">装修方式</th>
                            <th class="c18">设计师</th>
                            <th class="c19">业务员</th>
                            <th class="c20">工程监理</th>
                            <th class="c21">工长</th>
                            <th class="c22">渠道</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <volist name="customer" id="v" empty="$customer">
                            <tr>
                                <td class="c1" style="background:{$v.markcolor|markcolor}">
                                    <if condition="lastRecord($v[id])==''">
                                        <a href="{:U('Customer/visitRecord', array('id' => $v[id]))}">暂无追踪记录</a>
                                        <else/>
                                        <a href="{:U('Customer/visitRecord', array('id' => $v[id]))}" title="{$v.id|lastRecord}">{:msubstr(lastRecord($v[id]),0,34)}...</a>
                                    </if>
                                </td>
                                <td class="c2" style="background:{$v.markcolor|markcolor}">{$v.State|state}</td>
                                <td class="c3" style="background:{$v.markcolor|markcolor}">{$v.CName}</td>
                                <td class="c4" style="background:{$v.markcolor|markcolor}">{$v.Tel}</td>
                                <td class="c5" style="background:{$v.markcolor|markcolor}">{$v.Address}</td>
                                <td class="c6" style="background:{$v.markcolor|markcolor}">{$v.ConsultDate}</td>
                                <if condition="is_admin()">
                                    <td class="c7" style="background:{$v.markcolor|markcolor}"><empty name="v.sremind">--<else/>{$v.sremind}</empty></td>
                                    <td class="c23" style="background:{$v.markcolor|markcolor}"><empty name="v.dremind">--<else/>{$v.dremind}</empty></td>
                                    <td class="c24" style="background:{$v.markcolor|markcolor}"><empty name="v.premind">--<else/>{$v.premind}</empty></td>
                                    <elseif condition="is_salesman()" />
                                    <td class="c7" style="background:{$v.markcolor|markcolor}"><empty name="v.sremind">--<else/>{$v.sremind}</empty></td>
                                    <elseif condition="is_designer()"/>
                                    <td class="c7" style="background:{$v.markcolor|markcolor}"><empty name="v.dremind">--<else/>{$v.dremind}</empty></td>
                                    <elseif condition="is_project()"/>
                                    <td class="c7" style="background:{$v.markcolor|markcolor}"><empty name="v.premind">--<else/>{$v.premind}</empty></td>
                                    <elseif condition="is_manager()"/>
                                    <eq name="_SESSION['job']" value="1">
                                        <td class="c7" style="background:{$v.markcolor|markcolor}"><empty name="v.sremind">--<else/>{$v.sremind}</empty></td>
                                    </eq>
                                    <eq name="_SESSION['job']" value="2">
                                        <td class="c7" style="background:{$v.markcolor|markcolor}"><empty name="v.dremind">--<else/>{$v.dremind}</empty></td>
                                    </eq>
                                </if>
                                <td class="c8" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.ComeTime">--<else/>{$v.ComeTime}</empty>
                                </td>
                                <td class="c9" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.OrderTime">--<else/>{$v.OrderTime}</empty>
                                </td>
                                <td class="c10" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.HetongTime">--<else/>{$v.HetongTime}</empty>
                                </td>
                                <td class="c11" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.Number">--<else/>{$v.Number}</empty>
                                </td>
                                <td class="c28" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.jiaofangtime">--<else/>{$v.jiaofangtime}</empty>
                                </td>
                                <td class="c29" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.liangfangtime">--<else/>{$v.liangfangtime}</empty>
                                </td>
                                <td class="c12" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.StartTime">--<else/>{$v.StartTime}</empty>
                                </td>
                                <td class="c13" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.EndTime">--<else/>{$v.EndTime}</empty>
                                </td>
                                <td class="c14" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.Deposit">--<else/>{$v.Deposit}</empty>
                                </td>
                                <td class="c15" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.OrdersValue">--<else/>{$v.OrdersValue}</empty>
                                </td>
                                <td class="c16" style="background:{$v.markcolor|markcolor}">
                                    <empty name="v.Space">--<else/>{$v.Space}㎡</empty>
                                </td>
                                <td class="c17" style="background:{$v.markcolor|markcolor}">{$v.wayname}</td>
                                <td class="c18" style="background:{$v.markcolor|markcolor}">{$v.Designer|realname}</td>
                                <td class="c19" style="background:{$v.markcolor|markcolor}">{$v.realname}</td>
                                <td class="c20" style="background:{$v.markcolor|markcolor}">{$v.Project|realname}</td>
                                <td class="c21" style="background:{$v.markcolor|markcolor}">{$v.Captain|realname}</td>
                                <td class="c22" style="background:{$v.markcolor|markcolor}">{$v.channelname}</td>
                                <td style="background-color:{$v.markcolor|markcolor}">
                                    [<a style='font-size:12px;' href="{:U('Customer/recovery',array('id' => $v['id']))}">恢复</a>]
                                    [<a style='font-size:12px;' class="delcfm" src="{:U('Customer/deleteForever',array('id' => $v['id']))}">删除</a>]
                                </td>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                    <!--客户记录列表结束---->
                    <div class="portlet box blue page">&nbsp;共{$page}　
                        <neq name="sum" value=''>当前条件下的合同总额 : ￥{$sum|number_format}</neq>
                    </div>
                </div>
                </div>
				<!-- END EXAMPLE TABLE PORTLET-->
				</div>
			</div>
			<!-- END PAGE CONTENT-->
		</div>
	</div>
	<!-- END CONTENT -->
</div>
<!-- END CONTAINER -->
<include file="Common:footer" />
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="__PUBLIC__/global/plugins/respond.min.js"></script>
<script src="__PUBLIC__/global/plugins/excanvas.min.js"></script> 
<![endif]-->
<script src="__PUBLIC__/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.3.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="__PUBLIC__/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="__PUBLIC__/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/select2/select2.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<script type="text/javascript">
	var displayFields_url = "{:U('Customer/displayFields')}";
</script>
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="__PUBLIC__/global/scripts/metronic.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="__PUBLIC__/javascript/table-defined.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/pages/scripts/form-validation.js"></script>
<script src="__PUBLIC__/layer/layer.min.js"></script>
<script>
jQuery(document).ready(function() {       
	Metronic.init(); // init metronic core components
	Layout.init(); // init current layout
	QuickSidebar.init(); // init quick sidebar
	Demo.init(); // init demo features
	FormValidation.init();

    // 是否删除提示
    $('.delcfm').click(function(){
        var url = $(this).attr('src');
        $.layer({
            shade: [0],
            area: ['auto','auto'],
            dialog: {
                msg: '您确定要删除本条信息吗? 删除后不可恢复!',
                btns: 2,
                type: 4,
                btn: ['确定','取消'],
                yes: function(){
                    window.location = url;
                }, no: function(){
                    return false;
                }
            }
        });
    });
});
</script>
</body>
<!-- END BODY -->
</html>